{%- set title = _("Top 5 Works Cited") %}
{%- extends config.kerko.templates.page %}

{%- block head %}{{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{%- endblock %}

{%- block content_inner %}
    <div class="dashboard">
        <!-- Citation Chart -->
        <div class="chart-container">
            <h2>Publication References Over 13 Years</h2>
            <canvas id="myChart"></canvas>
        </div>
        <div class="chart-container">
            <h2>Publication Types</h2>
            <canvas id="pieChart"></canvas>
        </div>
        {# Departments pie chart temporarily disabled #}
        {#
        <div class="chart-container">
            <h2>Departments</h2>
            <canvas id="deptPieChart"></canvas>
            <div id="deptLegend" class="chart-legend"></div>
        </div>
        #}
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the chart
            var data = {{ chartJSON | safe }};
            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, data);
        });
    </script>
    <script>
        const pieChartJSON = {{ pieChartJSON|safe }};
        const pieCtx = document.getElementById('pieChart').getContext('2d');
        new Chart(pieCtx, pieChartJSON);
    </script>
    {# Departments pie chart scripts disabled #}
    {#
    <script>
        const deptPieChartJSON = {{ deptPieChartJSON|safe }};
        const deptLabels = {{ deptLabels|tojson }};
        const deptCounts = {{ deptCounts|tojson }};
        const deptCtx = document.getElementById('deptPieChart').getContext('2d');
        deptPieChartJSON.data.labels = deptLabels;
        deptPieChartJSON.data.datasets[0].data = deptCounts;
        const deptChart = new Chart(deptCtx, deptPieChartJSON);
        const legendTarget = document.getElementById('deptLegend');
        const labels = deptLabels;
        const colors = deptPieChartJSON.data.datasets[0].backgroundColor;
        const counts = deptCounts;
        legendTarget.innerHTML = labels.map((label, i) => {
            const color = colors[i % colors.length];
            const count = counts[i] ?? '';
            return `<span class="legend-item"><span class="legend-swatch" style="background:${color}"></span>${label} (${count})</span>`;
        }).join('');
    </script>
    #}
{%- endblock content_inner %}